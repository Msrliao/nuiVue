import{a as R}from"./apiClient-BboTgsdc.js";import{d as I,u as $,a as F,r as v,o as S,c as M,w as n,b as e,e as j,h as A,f as i,n as N,g as U,j as O,k as P,_ as T,i as X,m as Y,F as G}from"./index-CWiALeIP.js";import{l as H}from"./lodash-B3LoH-3H.js";const J=I({__name:"table",props:{data:{},loading:{type:Boolean}},emits:["refresh","edit"],setup(w,{emit:p}){const c=w,y=p,s=i(null);function m(){return[{title:"工号",key:"gh",sorter:"default"},{title:"姓名",key:"xm",sorter:"default"},{title:"性别",key:"xb"},{title:"出生日期",key:"csrq"},{title:"民族",key:"mz"},{title:"联系电话",key:"lxdh"},{title:"身份证号",key:"idcard"},{title:"邮箱",key:"yx"},{title:"职位",key:"zw"},{title:"部门",key:"bm"},{title:"工资级别",key:"gzjb"},{title:"入职日期",key:"rzrq"},{title:"试用期",key:"syq"},{title:"合同起始日期",key:"htsjzrq"},{title:"合同终止日期",key:"htsjzzrq"},{title:"紧急联系人",key:"emergencyContact"},{title:"紧急联系人电话",key:"emergencyContactPhone"},{title:"备注",key:"bz"},{title:"状态",key:"zt"}]}const f=$(),a=F(),_=m(),q=[{label:"编辑",key:"edit"},{label:()=>A("span",{style:{color:"red"}},"删除"),key:"delete"}],z=i(!1),k=i(0),h=i(0),b=z,l=k,t=h;function d(r){r==="edit"&&s.value?y("edit",s.value):r==="delete"&&s.value&&a.warning({title:"确认删除",content:`确定要删除员工"${s.value.xm}"吗？此操作不可恢复。`,positiveText:"删除",negativeText:"取消",onPositiveClick:async()=>{try{await R.delete(`/employees/${s.value?.id}`),f.success("员工删除成功"),y("refresh")}catch(x){f.error(x.message||"员工删除失败")}}}),z.value=!1}function u(){z.value=!1,s.value=null}function g(r){return{onContextmenu:x=>{s.value=r,x.preventDefault(),z.value=!1,N().then(()=>{z.value=!0,k.value=x.clientX,h.value=x.clientY})},onClick:x=>{s.value=r}}}return(r,x)=>{const C=v("n-data-table"),V=v("n-dropdown"),E=v("n-flex");return S(),M(E,null,{default:n(()=>[e(C,{columns:j(_),data:c.data,"row-props":g,loading:c.loading,striped:"","row-key":B=>B.id},null,8,["columns","data","loading","row-key"]),e(V,{placement:"bottom-start",trigger:"manual",x:j(l),y:j(t),options:q,show:j(b),"on-clickoutside":u,onSelect:d},null,8,["x","y","show"])]),_:1})}}}),K=I({__name:"addInfor",props:{show:{type:Boolean},editData:{}},emits:["close","refresh","update:show"],setup(w,{emit:p}){const c=w,y=p,s=i(null),m=i(c.show),f=$(),a=i({gh:"",xm:"",xb:"",csrq:"",mz:"",lxdh:"",idcard:"",yx:"",zw:"",bm:"",gzjb:"",rzrq:"",syq:"",htsjzrq:"",htsjzzrq:"",emergencyContact:"",emergencyContactPhone:"",bz:"",zt:"",id:void 0}),_=i([{label:"男",value:"男"},{label:"女",value:"女"}]),q=i([{label:"在职",value:"在职"},{label:"离职",value:"离职"},{label:"休假",value:"休假"}]),z={xm:{required:!0,message:"请输入姓名",trigger:"blur"},lxdh:{required:!0,message:"请输入联系电话",trigger:"blur"}};async function k(){if(s.value)try{await s.value.validate();const l={...a.value};a.value.id?(await R.put("/employees/"+a.value.id,l),f.success("数据修改成功")):(await R.post("/employees",l),f.success("数据保存成功")),m.value=!1,y("close"),y("refresh"),h()}catch(l){l.name==="ValidateError"?f.error("请检查表单填写是否正确"):f.error(l.message||"操作失败，请重试")}}function h(){s.value&&(a.value={gh:"",xm:"",xb:"",csrq:"",mz:"",lxdh:"",idcard:"",yx:"",zw:"",bm:"",gzjb:"",rzrq:"",syq:"",htsjzrq:"",htsjzzrq:"",emergencyContact:"",emergencyContactPhone:"",bz:"",zt:"",id:void 0},s.value.restoreValidation())}U(()=>c.show,l=>{m.value=l}),U(()=>m.value,l=>{y("update:show",l)}),U(()=>c.editData,l=>{l?a.value={gh:l.gh||"",xm:l.xm||"",xb:l.xb||"",csrq:l.csrq||"",mz:l.mz||"",lxdh:l.lxdh||"",idcard:l.idcard||"",yx:l.yx||"",zw:l.zw||"",bm:l.bm||"",gzjb:l.gzjb||"",rzrq:l.rzrq||"",syq:l.syq||"",htsjzrq:l.htsjzrq||"",htsjzzrq:l.htsjzzrq||"",emergencyContact:l.emergencyContact||"",emergencyContactPhone:l.emergencyContactPhone||"",bz:l.bz||"",zt:l.zt||"",id:l.id}:h()},{immediate:!0});function b(){m.value=!1,h()}return O(()=>{}),(l,t)=>{const d=v("n-input"),u=v("n-form-item-gi"),g=v("n-select"),r=v("n-date-picker"),x=v("n-grid"),C=v("n-button"),V=v("n-flex"),E=v("n-form"),B=v("n-modal");return S(),M(B,{show:m.value,"onUpdate:show":t[18]||(t[18]=o=>m.value=o),preset:"card",title:"新建员工资料",style:{width:"800px"}},{default:n(()=>[e(E,{ref_key:"formRef",ref:s,model:a.value,rules:z,"label-placement":"left","label-width":"auto"},{default:n(()=>[e(x,{cols:"1 s:1 m:2 l:2 xl:2 2xl:2",responsive:"screen"},{default:n(()=>[e(u,{label:"姓名:",path:"xm"},{default:n(()=>[e(d,{value:a.value.xm,"onUpdate:value":t[0]||(t[0]=o=>a.value.xm=o),placeholder:"请输入姓名"},null,8,["value"])]),_:1}),e(u,{label:"性别:",path:"xb"},{default:n(()=>[e(g,{value:a.value.xb,"onUpdate:value":t[1]||(t[1]=o=>a.value.xb=o),placeholder:"请选择性别",options:_.value},null,8,["value","options"])]),_:1}),e(u,{label:"出生日期:",path:"csrq"},{default:n(()=>[e(r,{value:a.value.csrq,"onUpdate:value":t[2]||(t[2]=o=>a.value.csrq=o),type:"date",placeholder:"请选择出生日期"},null,8,["value"])]),_:1}),e(u,{label:"民族:",path:"mz"},{default:n(()=>[e(d,{value:a.value.mz,"onUpdate:value":t[3]||(t[3]=o=>a.value.mz=o),placeholder:"请输入民族"},null,8,["value"])]),_:1}),e(u,{label:"联系电话:",path:"lxdh"},{default:n(()=>[e(d,{value:a.value.lxdh,"onUpdate:value":t[4]||(t[4]=o=>a.value.lxdh=o),placeholder:"请输入联系电话"},null,8,["value"])]),_:1}),e(u,{label:"身份证号:",path:"idcard"},{default:n(()=>[e(d,{value:a.value.idcard,"onUpdate:value":t[5]||(t[5]=o=>a.value.idcard=o),placeholder:"请输入身份证号"},null,8,["value"])]),_:1}),e(u,{label:"邮箱:",path:"yx"},{default:n(()=>[e(d,{value:a.value.yx,"onUpdate:value":t[6]||(t[6]=o=>a.value.yx=o),placeholder:"请输入邮箱"},null,8,["value"])]),_:1}),e(u,{label:"职位:",path:"zw"},{default:n(()=>[e(g,{value:a.value.xb,"onUpdate:value":t[7]||(t[7]=o=>a.value.xb=o),placeholder:"请选择职位",options:_.value},null,8,["value","options"])]),_:1}),e(u,{label:"部门:",path:"bm"},{default:n(()=>[e(g,{value:a.value.xb,"onUpdate:value":t[8]||(t[8]=o=>a.value.xb=o),placeholder:"请选择部门",options:_.value},null,8,["value","options"])]),_:1}),e(u,{label:"工资级别:",path:"gzjb"},{default:n(()=>[e(d,{value:a.value.gzjb,"onUpdate:value":t[9]||(t[9]=o=>a.value.gzjb=o),placeholder:"工资级别"},null,8,["value"])]),_:1}),e(u,{label:"入职日期:",path:"rzrq"},{default:n(()=>[e(r,{value:a.value.rzrq,"onUpdate:value":t[10]||(t[10]=o=>a.value.rzrq=o),type:"date",placeholder:"请选择入职日期"},null,8,["value"])]),_:1}),e(u,{label:"试用期:",path:"syq"},{default:n(()=>[e(d,{value:a.value.syq,"onUpdate:value":t[11]||(t[11]=o=>a.value.syq=o),placeholder:"请输入试用期"},null,8,["value"])]),_:1}),e(u,{label:"合同起始日期:",path:"htsjzrq"},{default:n(()=>[e(r,{value:a.value.htsjzrq,"onUpdate:value":t[12]||(t[12]=o=>a.value.htsjzrq=o),type:"date",placeholder:"请选择合同起始日期"},null,8,["value"])]),_:1}),e(u,{label:"合同终止日期:",path:"htsjzzrq"},{default:n(()=>[e(r,{value:a.value.htsjzzrq,"onUpdate:value":t[13]||(t[13]=o=>a.value.htsjzzrq=o),type:"date",placeholder:"请选择合同终止日期"},null,8,["value"])]),_:1}),e(u,{label:"紧急联系人:",path:"emergencyContact"},{default:n(()=>[e(d,{value:a.value.emergencyContact,"onUpdate:value":t[14]||(t[14]=o=>a.value.emergencyContact=o),placeholder:"请输入紧急联系人"},null,8,["value"])]),_:1}),e(u,{label:"紧急联系人电话:",path:"emergencyContactPhone"},{default:n(()=>[e(d,{value:a.value.emergencyContactPhone,"onUpdate:value":t[15]||(t[15]=o=>a.value.emergencyContactPhone=o),placeholder:"请输入紧急联系人电话"},null,8,["value"])]),_:1}),e(u,{label:"备注:",path:"bz"},{default:n(()=>[e(d,{value:a.value.bz,"onUpdate:value":t[16]||(t[16]=o=>a.value.bz=o),placeholder:"请输入备注"},null,8,["value"])]),_:1}),e(u,{label:"状态:",path:"zt"},{default:n(()=>[e(g,{value:a.value.zt,"onUpdate:value":t[17]||(t[17]=o=>a.value.zt=o),placeholder:"请选择状态",options:q.value},null,8,["value","options"])]),_:1})]),_:1}),e(V,{justify:"end"},{default:n(()=>[e(C,{"attr-type":"button",type:"error",onClick:h},{default:n(()=>[...t[19]||(t[19]=[P(" 清空 ",-1)])]),_:1}),e(C,{"attr-type":"button",type:"success",onClick:k},{default:n(()=>[...t[20]||(t[20]=[P(" 保存 ",-1)])]),_:1}),e(C,{"attr-type":"button",type:"warning",onClick:b},{default:n(()=>[...t[21]||(t[21]=[P(" 取消 ",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])}}}),L=T(K,[["__scopeId","data-v-48dd843e"]]),Q=I({__name:"index",setup(w){const p=i({gh:"",xm:"",bm:"",zw:""}),c=i({gh:"",xm:"",bm:"",zw:""}),y=i([]),s=i(!1),m=i(!1),f=i(null);function a(){m.value=!0,f.value=null}async function _(b){s.value=!0;try{const l=await R.get("/employees",{params:b});y.value=l||[]}catch(l){console.error("获取员工数据失败:",l),y.value=[]}finally{s.value=!1}}async function q(b){await _(b)}const z=H.debounce(()=>{c.value={...p.value},console.log("防抖搜索执行，参数：",c.value),q(c.value)},1e3);U(()=>p.value,()=>{z()},{deep:!0}),X(()=>{q(c.value)});function k(){q(c.value)}function h(b){f.value=b,m.value=!0}return(b,l)=>{const t=v("n-input"),d=v("n-form-item"),u=v("n-flex"),g=v("n-button");return S(),Y(G,null,[e(u,null,{default:n(()=>[e(d,{label:"工号:"},{default:n(()=>[e(t,{value:p.value.gh,"onUpdate:value":l[0]||(l[0]=r=>p.value.gh=r),placeholder:"请输入工号"},null,8,["value"])]),_:1}),e(d,{label:"姓名:"},{default:n(()=>[e(t,{value:p.value.xm,"onUpdate:value":l[1]||(l[1]=r=>p.value.xm=r),placeholder:"请输入姓名"},null,8,["value"])]),_:1}),e(d,{label:"部门:"},{default:n(()=>[e(t,{value:p.value.bm,"onUpdate:value":l[2]||(l[2]=r=>p.value.bm=r),placeholder:"请输入部门"},null,8,["value"])]),_:1}),e(d,{label:"职位:"},{default:n(()=>[e(t,{value:p.value.zw,"onUpdate:value":l[3]||(l[3]=r=>p.value.zw=r),placeholder:"请输入职位"},null,8,["value"])]),_:1})]),_:1}),e(u,null,{default:n(()=>[e(g,{onClick:l[4]||(l[4]=r=>a())},{default:n(()=>[...l[6]||(l[6]=[P(" 新增资料 ",-1)])]),_:1})]),_:1}),e(J,{data:y.value,loading:s.value,onEdit:h,onRefresh:k},null,8,["data","loading"]),e(u,null,{default:n(()=>[e(L,{show:m.value,"onUpdate:show":l[5]||(l[5]=r=>m.value=r),editData:f.value,onRefresh:k},null,8,["show","editData"])]),_:1})],64)}}}),ee=T(Q,[["__scopeId","data-v-47827cd7"]]);export{ee as default};
