import{a as S}from"./apiClient-BboTgsdc.js";import{d as I,u as P,a as G,r as h,o as F,c as N,w as u,b as a,e as T,h as H,f as i,n as J,g as $,i as L,j as K,k as B,_ as X,m as Q,F as W}from"./index-CWiALeIP.js";import{g as Z}from"./dataPorc-Bc56UePk.js";import{l as D}from"./lodash-B3LoH-3H.js";const ee=I({__name:"table",props:{data:{},loading:{type:Boolean}},emits:["refresh","edit"],setup(M,{emit:j}){const k=M,_=j,p=i(null);function x(){return[{title:"客户简称",key:"khjc",sorter:"default"},{title:"客户简拼",key:"khjp",sorter:"default"},{title:"客户全称",key:"khqc",sorter:"default"},{title:"联系人",key:"lxr"},{title:"联系电话",key:"lxdh"},{title:"座机电话",key:"zxdh"},{title:"其他联系方式",key:"qtlxfs"},{title:"联系地址",key:"lxdz"},{title:"银行账户名",key:"yhzhm"},{title:"银行账号",key:"yhzh"},{title:"所属银行",key:"ssyh"},{title:"客户类型",key:"khlx",render(s){return Array.isArray(s.khlx)?s.khlx.join(", "):s.khlx}},{title:"经营范围",key:"jyfw",render(s){return Array.isArray(s.jyfw)?s.jyfw.join(", "):s.jyfw}},{title:"所属地区",key:"ssqd",render(s){return Array.isArray(s.ssqd)?s.ssqd.join(", "):s.ssqd}},{title:"付款方式",key:"fkfs",render(s){return Array.isArray(s.fkfs)?s.fkfs.join(", "):s.fkfs}},{title:"默认物流",key:"mrwl",render(s){return Array.isArray(s.mrwl)?s.mrwl.join(", "):s.mrwl}},{title:"默认运货方式",key:"mryhfs",render(s){return Array.isArray(s.mryhfs)?s.mryhfs.join(", "):s.mryhfs}},{title:"备注",key:"bz"}]}const b=P(),e=G(),A=x(),g=[{label:"编辑",key:"edit"},{label:()=>H("span",{style:{color:"red"}},"删除"),key:"delete"}],m=i(!1),q=i(0),z=i(0),w=m,C=q,E=z;function O(s){s==="edit"&&p.value?_("edit",p.value):s==="delete"&&p.value&&e.warning({title:"确认删除",content:`确定要删除客户"${p.value.khjc}"吗？此操作不可恢复。`,positiveText:"删除",negativeText:"取消",onPositiveClick:async()=>{try{await S.delete(`/customers/${p.value?.id}`),b.success("客户删除成功"),_("refresh")}catch(l){b.error(l.message||"客户删除失败")}}}),m.value=!1}function y(){m.value=!1,p.value=null}function o(s){return{onContextmenu:l=>{p.value=s,l.preventDefault(),m.value=!1,J().then(()=>{m.value=!0,q.value=l.clientX,z.value=l.clientY})},onClick:l=>{p.value=s}}}return(s,l)=>{const t=h("n-data-table"),v=h("n-dropdown"),d=h("n-flex");return F(),N(d,null,{default:u(()=>[a(t,{columns:T(A),data:k.data,"row-props":o,loading:k.loading,striped:"","row-key":f=>f.id},null,8,["columns","data","loading","row-key"]),a(v,{placement:"bottom-start",trigger:"manual",x:T(C),y:T(E),options:g,show:T(w),"on-clickoutside":y,onSelect:O},null,8,["x","y","show"])]),_:1})}}}),le=I({__name:"addInfor",props:{show:{type:Boolean},editData:{}},emits:["close","refresh"],setup(M,{emit:j}){const k=M,_=j,p=i(null),x=i(k.show),b=P(),e=i({khjc:"",khjp:"",khqc:"",lxr:"",lxrjp:"",lxdh:"",zxdh:"",qtlxfs:"",lxdz:"",yhzhm:"",yhzh:"",ssyh:"",khlx:[],jyfw:[],ssqd:[],fkfs:[],mrwl:[],mryhfs:[],bz:"",id:void 0}),A=i([]),g=i([]),m=i([]),q=i([]),z=i([]),w=i([]),C=i([]);async function E(){try{const l=await S.get("/customers"),t=new Set,v=new Set,d=new Set,f=new Set,R=new Set,U=new Set,V=new Set;l.forEach(r=>{r.ssyh&&t.add(r.ssyh),Array.isArray(r.khlx)?r.khlx.forEach(c=>v.add(c)):r.khlx&&v.add(r.khlx),Array.isArray(r.jyfw)?r.jyfw.forEach(c=>d.add(c)):r.jyfw&&d.add(r.jyfw),Array.isArray(r.ssqd)?r.ssqd.forEach(c=>f.add(c)):r.ssqd&&f.add(r.ssqd),Array.isArray(r.fkfs)?r.fkfs.forEach(c=>R.add(c)):r.fkfs&&R.add(r.fkfs),Array.isArray(r.mrwl)?r.mrwl.forEach(c=>U.add(c)):r.mrwl&&U.add(r.mrwl),Array.isArray(r.mryhfs)?r.mryhfs.forEach(c=>V.add(c)):r.mryhfs&&V.add(r.mryhfs)}),A.value=Array.from(t).map(r=>({label:r,value:r})),g.value=Array.from(v).map(r=>({label:r,value:r})),m.value=Array.from(d).map(r=>({label:r,value:r})),q.value=Array.from(f).map(r=>({label:r,value:r})),z.value=Array.from(R).map(r=>({label:r,value:r})),w.value=Array.from(U).map(r=>({label:r,value:r})),C.value=Array.from(V).map(r=>({label:r,value:r}))}catch(l){b.error("获取客户选项数据失败，请重试"),console.error("获取客户选项数据失败：",l)}}const O={khjc:{required:!0,message:"请输入客户简称",trigger:"blur"},khjp:{required:!0,message:"请输入客户简拼",trigger:["input","blur"]},khqc:{required:!0,message:"请输入客户全称",trigger:["input"]}};async function y(){if(p.value)try{await p.value.validate();const l={...e.value,khlx:Array.isArray(e.value.khlx)?e.value.khlx:[],jyfw:Array.isArray(e.value.jyfw)?e.value.jyfw:[],ssqd:Array.isArray(e.value.ssqd)?e.value.ssqd:[],fkfs:Array.isArray(e.value.fkfs)?e.value.fkfs:[],mrwl:Array.isArray(e.value.mrwl)?e.value.mrwl:[],mryhfs:Array.isArray(e.value.mryhfs)?e.value.mryhfs:[]};e.value.id?(await S.put("/customers/"+e.value.id,l),b.success("数据修改成功")):(await S.post("/customers",l),b.success("数据保存成功")),x.value=!1,_("close"),_("refresh"),o()}catch(l){l.name==="ValidateError"?b.error("请检查表单填写是否正确"):b.error(l.message||"操作失败，请重试")}}function o(){p.value&&(e.value={khjc:"",khjp:"",khqc:"",lxr:"",lxrjp:"",lxdh:"",zxdh:"",qtlxfs:"",lxdz:"",yhzhm:"",yhzh:"",ssyh:"",khlx:[],jyfw:[],ssqd:[],fkfs:[],mrwl:[],mryhfs:[],bz:"",id:void 0},p.value.restoreValidation())}$(()=>k.show,l=>{x.value=l}),$(()=>k.editData,l=>{l?e.value={khjc:l.khjc||"",khjp:l.khjp||"",khqc:l.khqc||"",lxr:l.lxr||"",lxrjp:l.lxrjp||"",lxdh:l.lxdh||"",zxdh:l.zxdh||"",qtlxfs:l.qtlxfs||"",lxdz:l.lxdz||"",yhzhm:l.yhzhm||"",yhzh:l.yhzh||"",ssyh:l.ssyh||"",khlx:Array.isArray(l.khlx)?l.khlx:[],jyfw:Array.isArray(l.jyfw)?l.jyfw:[],ssqd:Array.isArray(l.ssqd)?l.ssqd:[],fkfs:Array.isArray(l.fkfs)?l.fkfs:[],mrwl:Array.isArray(l.mrwl)?l.mrwl:[],mryhfs:Array.isArray(l.mryhfs)?l.mryhfs:[],bz:l.bz||"",id:l.id}:o()},{immediate:!0}),$(()=>e.value.khjc,()=>{const l=Z(e.value.khjc);e.value.khjp=l});function s(){x.value=!1,_("close"),o()}return L(()=>{E()}),K(()=>{}),(l,t)=>{const v=h("n-input"),d=h("n-form-item-gi"),f=h("n-select"),R=h("n-grid"),U=h("n-button"),V=h("n-flex"),r=h("n-form"),c=h("n-card"),Y=h("n-modal");return F(),N(Y,{show:x.value,"onUpdate:show":t[18]||(t[18]=n=>x.value=n)},{default:u(()=>[a(c,{style:{"max-width":"600px"},title:"新建客户资料",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{default:u(()=>[a(r,{ref_key:"formRef",ref:p,model:e.value,rules:O,"label-placement":"left","label-width":"auto"},{default:u(()=>[a(R,{cols:"1 s:1 m:2 l:2 xl:2 2xl:2",responsive:"screen"},{default:u(()=>[a(d,{label:"客户简称:",path:"khjc"},{default:u(()=>[a(v,{value:e.value.khjc,"onUpdate:value":t[0]||(t[0]=n=>e.value.khjc=n),placeholder:"请输入客户简称"},null,8,["value"])]),_:1}),a(d,{label:"客户简拼:",path:"khjp"},{default:u(()=>[a(v,{value:e.value.khjp,"onUpdate:value":t[1]||(t[1]=n=>e.value.khjp=n),placeholder:"请输入客户简拼",disabled:"false"},null,8,["value"])]),_:1}),a(d,{label:"客户全称:",path:"khqc"},{default:u(()=>[a(v,{value:e.value.khqc,"onUpdate:value":t[2]||(t[2]=n=>e.value.khqc=n),placeholder:"请输入客户全称"},null,8,["value"])]),_:1}),a(d,{label:"联系人:",path:"lxr"},{default:u(()=>[a(v,{value:e.value.lxr,"onUpdate:value":t[3]||(t[3]=n=>e.value.lxr=n),placeholder:"请输入联系人"},null,8,["value"])]),_:1}),a(d,{label:"联系电话:",path:"lxdh"},{default:u(()=>[a(v,{value:e.value.lxdh,"onUpdate:value":t[4]||(t[4]=n=>e.value.lxdh=n),placeholder:"请输入联系电话"},null,8,["value"])]),_:1}),a(d,{label:"座机电话:",path:"zxdh"},{default:u(()=>[a(v,{value:e.value.zxdh,"onUpdate:value":t[5]||(t[5]=n=>e.value.zxdh=n),placeholder:"请输入座机电话"},null,8,["value"])]),_:1}),a(d,{label:"其他联系方式:",path:"qtlxfs"},{default:u(()=>[a(v,{value:e.value.qtlxfs,"onUpdate:value":t[6]||(t[6]=n=>e.value.qtlxfs=n),placeholder:"请输入其他联系方式"},null,8,["value"])]),_:1}),a(d,{label:"联系地址:",path:"lxdz"},{default:u(()=>[a(v,{value:e.value.lxdz,"onUpdate:value":t[7]||(t[7]=n=>e.value.lxdz=n),placeholder:"请输入联系地址"},null,8,["value"])]),_:1}),a(d,{label:"银行账户名:",path:"yhzhm"},{default:u(()=>[a(v,{value:e.value.yhzhm,"onUpdate:value":t[8]||(t[8]=n=>e.value.yhzhm=n),placeholder:"请输入银行账户名"},null,8,["value"])]),_:1}),a(d,{label:"银行账号:",path:"yhzh"},{default:u(()=>[a(v,{value:e.value.yhzh,"onUpdate:value":t[9]||(t[9]=n=>e.value.yhzh=n),placeholder:"请输入银行账号"},null,8,["value"])]),_:1}),a(d,{label:"所属银行:",path:"ssyh"},{default:u(()=>[a(f,{value:e.value.ssyh,"onUpdate:value":t[10]||(t[10]=n=>e.value.ssyh=n),placeholder:"请选择所属银行",options:A.value,filterable:"",tag:""},null,8,["value","options"])]),_:1}),a(d,{label:"客户类型:",path:"khlx"},{default:u(()=>[a(f,{value:e.value.khlx,"onUpdate:value":t[11]||(t[11]=n=>e.value.khlx=n),placeholder:"请选择客户类型",options:g.value,multiple:"",filterable:"",tag:""},null,8,["value","options"])]),_:1}),a(d,{label:"经营范围:",path:"jyfw"},{default:u(()=>[a(f,{value:e.value.jyfw,"onUpdate:value":t[12]||(t[12]=n=>e.value.jyfw=n),placeholder:"请选择经营范围",options:m.value,multiple:"",filterable:"",tag:""},null,8,["value","options"])]),_:1}),a(d,{label:"所属地区:",path:"ssqd"},{default:u(()=>[a(f,{value:e.value.ssqd,"onUpdate:value":t[13]||(t[13]=n=>e.value.ssqd=n),placeholder:"请选择或输入所属地区",options:q.value,multiple:"",filterable:"",tag:""},null,8,["value","options"])]),_:1}),a(d,{label:"付款方式:",path:"fkfs"},{default:u(()=>[a(f,{value:e.value.fkfs,"onUpdate:value":t[14]||(t[14]=n=>e.value.fkfs=n),placeholder:"请选择付款方式",options:z.value,multiple:"",filterable:"",tag:""},null,8,["value","options"])]),_:1}),a(d,{label:"默认物流:",path:"mrwl"},{default:u(()=>[a(f,{value:e.value.mrwl,"onUpdate:value":t[15]||(t[15]=n=>e.value.mrwl=n),placeholder:"请选择默认物流",options:w.value,multiple:"",filterable:"",tag:""},null,8,["value","options"])]),_:1}),a(d,{label:"默认运货方式:",path:"mryhfs"},{default:u(()=>[a(f,{value:e.value.mryhfs,"onUpdate:value":t[16]||(t[16]=n=>e.value.mryhfs=n),placeholder:"请选择默认运货方式",options:C.value,multiple:"",filterable:"",tag:""},null,8,["value","options"])]),_:1}),a(d,{span:24,label:"备注:",path:"bz",style:{width:"100%"}},{default:u(()=>[a(v,{value:e.value.bz,"onUpdate:value":t[17]||(t[17]=n=>e.value.bz=n),placeholder:"请输入备注",type:"textarea",autosize:{minRows:2,maxRows:3}},null,8,["value"])]),_:1})]),_:1}),a(V,{justify:"end"},{default:u(()=>[a(U,{"attr-type":"button",type:"error",onClick:o},{default:u(()=>[...t[19]||(t[19]=[B(" 清空 ",-1)])]),_:1}),a(U,{"attr-type":"button",type:"success",onClick:y},{default:u(()=>[...t[20]||(t[20]=[B(" 保存 ",-1)])]),_:1}),a(U,{"attr-type":"button",type:"warning",onClick:s},{default:u(()=>[...t[21]||(t[21]=[B(" 取消 ",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show"])}}}),ae=X(le,[["__scopeId","data-v-d8747d35"]]),te=I({__name:"index",setup(M){const j=i(!1),k=i(null),_=P(),p=i([]),x=i([]);async function b(){try{const y=await S.get("/customers"),o=new Set,s=new Set;y.forEach(l=>{Array.isArray(l.khlx)?l.khlx.forEach(t=>o.add(t)):l.khlx&&o.add(l.khlx),Array.isArray(l.ssqd)?l.ssqd.forEach(t=>s.add(t)):l.ssqd&&s.add(l.ssqd)}),p.value=Array.from(o).map(l=>({label:l,value:l})),x.value=Array.from(s).map(l=>({label:l,value:l}))}catch(y){_.error("获取客户选项数据失败，请重试"),console.error("获取客户选项数据失败：",y)}}const e=i({}),A=i({}),g=i([]),m=i(!1);function q(){j.value=!0,k.value=null}async function z(y){m.value=!0;try{const o={...y};o.khlx&&Array.isArray(o.khlx)&&(o.khlx=o.khlx.join(",")),o.khdq&&Array.isArray(o.khdq)&&(o.khdq=o.khdq.join(","));const s=await S.get("/customers",{params:o});g.value=s||[]}catch(o){console.error("获取客户数据失败:",o),g.value=[]}finally{m.value=!1}}async function w(y){await z(y)}const C=D.debounce(()=>{A.value={...e.value},console.log("防抖搜索执行，参数：",A.value),w(A.value)},1e3);$(()=>e.value,()=>{C()},{deep:!0}),L(()=>{w(A.value),b()});function E(){w(A.value)}function O(y){k.value=y,j.value=!0}return(y,o)=>{const s=h("n-input"),l=h("n-form-item"),t=h("n-select"),v=h("n-flex"),d=h("n-button");return F(),Q(W,null,[a(v,null,{default:u(()=>[a(l,{label:"客户简拼:"},{default:u(()=>[a(s,{value:e.value.khjp,"onUpdate:value":o[0]||(o[0]=f=>e.value.khjp=f),placeholder:"请输入客户简拼"},null,8,["value"])]),_:1}),a(l,{label:"联系电话:"},{default:u(()=>[a(s,{value:e.value.lxdh,"onUpdate:value":o[1]||(o[1]=f=>e.value.lxdh=f),placeholder:"请输入联系电话"},null,8,["value"])]),_:1}),a(l,{label:"联系人简拼:"},{default:u(()=>[a(s,{value:e.value.lxrjp,"onUpdate:value":o[2]||(o[2]=f=>e.value.lxrjp=f),placeholder:"请输入联系人简拼"},null,8,["value"])]),_:1}),a(l,{label:"客户类型:"},{default:u(()=>[a(t,{value:e.value.khlx,"onUpdate:value":o[3]||(o[3]=f=>e.value.khlx=f),placeholder:"请选择客户类型",options:p.value,filterable:"",tag:"",clearable:""},null,8,["value","options"])]),_:1}),a(l,{label:"客户地区:"},{default:u(()=>[a(t,{value:e.value.khdq,"onUpdate:value":o[4]||(o[4]=f=>e.value.khdq=f),placeholder:"请选择客户地区",options:x.value,filterable:"",tag:"",clearable:""},null,8,["value","options"])]),_:1})]),_:1}),a(v,null,{default:u(()=>[a(d,{onClick:o[5]||(o[5]=f=>q())},{default:u(()=>[...o[7]||(o[7]=[B(" 新增资料 ",-1)])]),_:1})]),_:1}),a(ee,{data:g.value,loading:m.value,onEdit:O,onRefresh:E},null,8,["data","loading"]),a(v,null,{default:u(()=>[a(ae,{show:j.value,editData:k.value,onClose:o[6]||(o[6]=f=>j.value=!1),onRefresh:E},null,8,["show","editData"])]),_:1})],64)}}}),ue=X(te,[["__scopeId","data-v-9a516e78"]]);export{ue as default};
