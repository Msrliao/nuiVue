import{a as z}from"./apiClient-BboTgsdc.js";import{d as K,u as F,a as Q,r as f,o as O,c as L,w as u,b as a,e as D,h as N,f as s,n as q,g as T,i as X,j as Z,k as B,l as ee,_ as Y,m as le,F as te}from"./index-CWiALeIP.js";import{g as M}from"./dataPorc-Bc56UePk.js";import{l as ae}from"./lodash-B3LoH-3H.js";const oe=K({__name:"table",props:{data:{},loading:{type:Boolean}},emits:["refresh","edit"],setup(V,{emit:v}){const g=V,_=v,m=s(null);function h(){return[{title:"序号",key:"xh",sorter:(n,c)=>n.id-c.id,render:(n,c)=>c+1},{title:"配件序码",key:"xm",sorter:"default"},{title:"配件编码",key:"bm",sorter:"default"},{title:"配件名称",key:"mc",sorter:"default"},{title:"适用车型",key:"cx",render:n=>Array.isArray(n.cx)?n.cx.join(" | "):n.cx},{title:"品牌",key:"pp",sorter:"default"},{title:"单位",key:"dw"},{title:"预设进价",key:"ysjj",sorter:"default"},{title:"配件简拼",key:"jp"},{title:"规格型号",key:"gg",render:n=>Array.isArray(n.gg)?n.gg.join(" | "):n.gg},{title:"库位",key:"kw",render:n=>n.kw_display||n.kw},{title:"备注",key:"bz"}]}const A=h(),t=[{label:"编辑",key:"edit"},{label:()=>N("span",{style:{color:"red"}},"删除"),key:"delete"}],x=F(),w=Q(),k=s(!1),C=s(0),j=s(0),R=k,S=C,P=j;function b(n){n==="edit"&&m.value?_("edit",m.value):n==="delete"&&m.value&&w.warning({title:"确认删除",content:`确定要删除配件"${m.value.xm}"吗？此操作不可恢复。`,positiveText:"删除",negativeText:"取消",onPositiveClick:async()=>{try{await z.delete(`/part-info/${m.value?.id}`),x.success("配件删除成功"),_("refresh")}catch(c){x.error(c.message||"配件删除失败")}}}),k.value=!1}function o(){k.value=!1,m.value=null}function p(n){return{onContextmenu:c=>{m.value=n,c.preventDefault(),k.value=!1,q().then(()=>{k.value=!0,C.value=c.clientX,j.value=c.clientY})},onClick:c=>{m.value=n}}}return(n,c)=>{const I=f("n-data-table"),e=f("n-dropdown"),l=f("n-flex");return O(),L(l,null,{default:u(()=>[a(I,{columns:D(A),data:g.data,"row-props":p,loading:g.loading,striped:"","row-key":i=>i.id},null,8,["columns","data","loading","row-key"]),a(e,{placement:"bottom-start",trigger:"manual",x:D(S),y:D(P),options:t,show:D(R),"on-clickoutside":o,onSelect:b},null,8,["x","y","show"])]),_:1})}}}),ne=K({__name:"DKTable",props:{data:{},loading:{type:Boolean}},setup(V){const v=s([]),g=s(null),_=V;function m(){return[{type:"selection",multiple:!1},{title:"序号",key:"xh",sorter:"default",render:(o,p)=>p+1},{title:"编码",key:"商品编码",sorter:"default"},{title:"名称",key:"商品名称"},{title:"车型",key:"车型"},{title:"总库存",key:"总库存"},{title:"品牌",key:"品牌"},{title:"批发价",key:"批发价"},{title:"零售价",key:"零售价"},{title:"调拨价",key:"调拨价"},{title:"进价",key:"参考进价"}]}const h=m(),A=[{label:"编辑",key:"edit"},{label:()=>N("span",{style:{color:"red"}},"删除"),key:"delete"}],t=F(),x=s(!1),w=s(0),k=s(0),C=x,j=w,R=k;function S(){x.value=!1}function P(){x.value=!1}function b(o){return{onContextmenu:p=>{t.info(JSON.stringify(o,null,2)),p.preventDefault(),x.value=!1,q().then(()=>{x.value=!0,w.value=p.clientX,k.value=p.clientY})},onClick:p=>{p.preventDefault(),p.stopPropagation(),g.value=o,v.value=[o.key]}}}return(o,p)=>{const n=f("n-data-table"),c=f("n-dropdown"),I=f("n-flex");return O(),L(I,null,{default:u(()=>[a(n,{"checked-row-keys":v.value,"onUpdate:checkedRowKeys":p[0]||(p[0]=e=>v.value=e),columns:D(h),data:_.data,"row-props":b,loading:_.loading,striped:"","row-key":e=>e.key,"single-line":!0},null,8,["checked-row-keys","columns","data","loading","row-key"]),a(c,{placement:"bottom-start",trigger:"manual",x:D(j),y:D(R),options:A,show:D(C),"on-clickoutside":P,onSelect:S},null,8,["x","y","show"])]),_:1})}}}),ue=K({__name:"addInfor",props:{show:{type:Boolean},editData:{}},emits:["close","refresh"],setup(V,{emit:v}){const g=F(),_=s(null),m=V,h=v,A=ee(()=>m.show),t=s({xm:"",bm:"",mc:"",jp:"",cx:[],cxjp:"",dw:"",pp:"",gg:[],kw:"",ysjj:"",bz:"",id:void 0}),x=s([]),w=s(!1),k=s([]),C=s([]),j=s([]),R=s([]),S={mc:{required:!0,message:"请输入名称",trigger:"blur"},cx:{required:!0,message:"请至少选择一个车型",trigger:["input","blur"],validator:(e,l,i)=>{l&&l.length>0?i():i(new Error("请至少选择一个车型"))}}};function P(e,l=null){return e.filter(i=>i.parent_id===l).map(i=>({label:i.name||i.position_name,key:i.id.toString(),children:P(e,i.id)}))}async function b(){w.value=!0;try{const e=await z.get("/warehouses"),l=await z.get("/positions"),i=e.map((y,U)=>{const r=l.filter($=>$.warehouse_id===y.id),E=P(r);return{label:y.ckmc,key:`root-${y.id}`,children:E}});x.value=i}catch(e){g.error("获取仓库和库位数据失败，请重试"),console.error("获取仓库和库位数据失败：",e)}finally{w.value=!1}}async function o(){w.value=!0;try{const e=await z.get("/part-info"),l=new Set,i=new Set,y=new Set,U=new Set;e.forEach(r=>{Array.isArray(r.cx)?r.cx.forEach(E=>l.add(E)):r.cx&&l.add(r.cx),r.dw&&i.add(r.dw),r.pp&&y.add(r.pp),Array.isArray(r.gg)?r.gg.forEach(E=>U.add(E)):r.gg&&U.add(r.gg)}),k.value=Array.from(l).map(r=>({label:r,value:r})),C.value=Array.from(i).map(r=>({label:r,value:r})),j.value=Array.from(y).map(r=>({label:r,value:r})),R.value=Array.from(U).map(r=>({label:r,value:r}))}catch(e){g.error("获取配件信息数据失败，请重试"),console.error("获取配件信息数据失败：",e)}finally{w.value=!1}}function p(e,l){console.log("Selected value:",e),console.log("Selected option:",l),e&&(t.value.kw=Array.isArray(e)?e[0]:e)}async function n(){_.value&&_.value.validate(async e=>{if(e)console.log("表单校验失败：",e),g.error("表单校验失败，请完善必填项");else try{t.value.id?(await z.put("/part-info/"+t.value.id,t.value),g.success("数据修改成功")):(await z.post("/part-info",t.value),g.success("数据保存成功")),c(),h("refresh"),h("close")}catch(l){g.error("数据操作失败，请重试"),console.error("保存失败：",l)}})}function c(){_.value&&(t.value={xm:"",bm:"",mc:"",jp:"",cx:[],cxjp:"",dw:"",pp:"",gg:[],kw:"",ysjj:"",bz:"",id:void 0},_.value.restoreValidation())}function I(){c(),h("close")}return T(()=>t.value.mc,()=>{const e=M(t.value.mc);t.value.jp=e}),T(()=>t.value.cx,()=>{if(t.value.cx&&Array.isArray(t.value.cx)){const e=t.value.cx.map(l=>M(l)).join("");t.value.cxjp=e}else t.value.cxjp=""}),T(()=>m.editData,e=>{e?t.value={xm:e.xm||"",bm:e.bm||"",mc:e.mc||"",jp:e.jp||"",cx:Array.isArray(e.cx)?e.cx:[],cxjp:e.cxjp||"",dw:e.dw||"",pp:e.pp||"",gg:Array.isArray(e.gg)?e.gg:[],kw:e.kw||"",ysjj:e.ysjj||"",bz:e.bz||"",id:e.id}:c()},{immediate:!0}),X(()=>{b(),o()}),Z(()=>{}),(e,l)=>{const i=f("n-input"),y=f("n-form-item-gi"),U=f("n-select"),r=f("n-tree-select"),E=f("n-grid"),$=f("n-button"),J=f("n-flex"),W=f("n-form"),G=f("n-card"),H=f("n-modal");return O(),L(H,{show:A.value,"onUpdate:show":l[11]||(l[11]=d=>A.value=d)},{default:u(()=>[a(G,{style:{"max-width":"600px"},title:"新建配件资料",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{default:u(()=>[a(W,{ref_key:"formRef",ref:_,model:t.value,rules:S,"label-placement":"left","label-width":"auto"},{default:u(()=>[a(E,{cols:"1 s:1 m:2 l:2 xl:2 2xl:2",responsive:"screen"},{default:u(()=>[a(y,{label:"序码:",path:"xm"},{default:u(()=>[a(i,{value:t.value.xm,"onUpdate:value":l[0]||(l[0]=d=>t.value.xm=d),placeholder:"请输入配件序码"},null,8,["value"])]),_:1}),a(y,{label:"编码:",path:"bm"},{default:u(()=>[a(i,{value:t.value.bm,"onUpdate:value":l[1]||(l[1]=d=>t.value.bm=d),placeholder:"请输入配件编码"},null,8,["value"])]),_:1}),a(y,{label:"名称:",path:"mc"},{default:u(()=>[a(i,{value:t.value.mc,"onUpdate:value":l[2]||(l[2]=d=>t.value.mc=d),placeholder:"请输入配件名称"},null,8,["value"])]),_:1}),a(y,{label:"简拼:",path:"jp"},{default:u(()=>[a(i,{value:t.value.jp,"onUpdate:value":l[3]||(l[3]=d=>t.value.jp=d),placeholder:"请输入配件简拼",disabled:"false"},null,8,["value"])]),_:1}),a(y,{label:"车型:",path:"cx"},{default:u(()=>[a(U,{value:t.value.cx,"onUpdate:value":l[4]||(l[4]=d=>t.value.cx=d),placeholder:"请选择车型",options:k.value,multiple:"",filterable:"",tag:""},null,8,["value","options"])]),_:1}),a(y,{label:"单位:",path:"dw"},{default:u(()=>[a(U,{value:t.value.dw,"onUpdate:value":l[5]||(l[5]=d=>t.value.dw=d),placeholder:"请选择单位",options:C.value,filterable:"",tag:""},null,8,["value","options"])]),_:1}),a(y,{label:"品牌:",path:"pp"},{default:u(()=>[a(U,{value:t.value.pp,"onUpdate:value":l[6]||(l[6]=d=>t.value.pp=d),placeholder:"请选择品牌",options:j.value,filterable:"",tag:""},null,8,["value","options"])]),_:1}),a(y,{label:"规格:",path:"gg"},{default:u(()=>[a(U,{value:t.value.gg,"onUpdate:value":l[7]||(l[7]=d=>t.value.gg=d),placeholder:"请选择规格",options:R.value,multiple:"",filterable:"",tag:""},null,8,["value","options"])]),_:1}),a(y,{label:"库位:",path:"kw"},{default:u(()=>[a(r,{value:t.value.kw,"onUpdate:value":[l[8]||(l[8]=d=>t.value.kw=d),p],options:x.value,placeholder:"请选择库位",loading:w.value},null,8,["value","options","loading"])]),_:1}),a(y,{label:"预设进价:",path:"ysjj"},{default:u(()=>[a(i,{value:t.value.ysjj,"onUpdate:value":l[9]||(l[9]=d=>t.value.ysjj=d),placeholder:"请输入预设进价"},null,8,["value"])]),_:1}),a(y,{span:24,label:"备注:",path:"bz",style:{width:"100%"}},{default:u(()=>[a(i,{value:t.value.bz,"onUpdate:value":l[10]||(l[10]=d=>t.value.bz=d),placeholder:"请输入配件备注",type:"textarea",autosize:{minRows:2,maxRows:3}},null,8,["value"])]),_:1})]),_:1}),a(J,{justify:"end"},{default:u(()=>[a($,{"attr-type":"button",type:"error",onClick:c},{default:u(()=>[...l[12]||(l[12]=[B(" 清空 ",-1)])]),_:1}),a($,{"attr-type":"button",type:"success",onClick:n},{default:u(()=>[...l[13]||(l[13]=[B(" 保存 ",-1)])]),_:1}),a($,{"attr-type":"button",type:"warning",onClick:I},{default:u(()=>[...l[14]||(l[14]=[B(" 取消 ",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show"])}}}),re=Y(ue,[["__scopeId","data-v-5618eab0"]]),se=K({__name:"index",setup(V){const v=s({mc:"",cx:"",gg:"",bm:""}),g=s({mc:"",cx:"",gg:"",bm:""}),_=s([]),m=s([]),h=s(!1),A=s(!1),t=s(!1),x=s(null);function w(){t.value=!0,x.value=null}async function k(b){h.value=!0;try{const o=await z.get("/part-info",{params:b});_.value=o||[]}catch(o){console.error("获取配件数据失败:",o),_.value=[]}finally{h.value=!1}}async function C(b){A.value=!0;try{const o=await z.get("/DK-info",{params:b});o&&Array.isArray(o)?m.value=o:m.value=[]}catch(o){console.error("获取大库数据失败:",o),m.value=[]}finally{A.value=!1}}async function j(b){await Promise.all([k(b),C(b)])}const R=ae.debounce(()=>{g.value={...v.value},console.log("防抖搜索执行，参数：",g.value),j(g.value)},1e3);T(()=>v.value,()=>{R()},{deep:!0}),X(()=>{console.log("配件资料页面挂载"),j(g.value)});function S(){j(g.value)}function P(b){x.value=b,t.value=!0}return(b,o)=>{const p=f("n-input"),n=f("n-form-item"),c=f("n-flex"),I=f("n-button");return O(),le(te,null,[a(c,null,{default:u(()=>[a(n,{label:"配件编码:"},{default:u(()=>[a(p,{value:v.value.bm,"onUpdate:value":o[0]||(o[0]=e=>v.value.bm=e),placeholder:"请输入配件编码"},null,8,["value"])]),_:1}),a(n,{label:"配件车型:"},{default:u(()=>[a(p,{value:v.value.cx,"onUpdate:value":o[1]||(o[1]=e=>v.value.cx=e),placeholder:"请输入配件车型"},null,8,["value"])]),_:1}),a(n,{label:"配件名称:"},{default:u(()=>[a(p,{value:v.value.mc,"onUpdate:value":o[2]||(o[2]=e=>v.value.mc=e),placeholder:"请输入配件名称"},null,8,["value"])]),_:1}),a(n,{label:"配件规格:"},{default:u(()=>[a(p,{value:v.value.gg,"onUpdate:value":o[3]||(o[3]=e=>v.value.gg=e),placeholder:"请输入配件规格"},null,8,["value"])]),_:1})]),_:1}),a(c,null,{default:u(()=>[a(I,{onClick:o[4]||(o[4]=e=>w())},{default:u(()=>[...o[6]||(o[6]=[B(" 新增资料 ",-1)])]),_:1})]),_:1}),a(oe,{data:_.value,loading:h.value,onEdit:P,onRefresh:S},null,8,["data","loading"]),a(ne,{data:m.value,loading:A.value},null,8,["data","loading"]),a(c,null,{default:u(()=>[a(re,{show:t.value,editData:x.value,onClose:o[5]||(o[5]=e=>t.value=!1),onRefresh:S},null,8,["show","editData"])]),_:1})],64)}}}),fe=Y(se,[["__scopeId","data-v-4381dc7d"]]);export{fe as default};
