import{a as N}from"./apiClient-BboTgsdc.js";import{d as E,u as S,a as T,r as i,o as I,c as $,w as n,b as l,e as w,h as q,f as v,n as F,g as D,j,k as P,_ as M,i as L,m as O,F as X}from"./index-CWiALeIP.js";import{l as Y}from"./lodash-B3LoH-3H.js";const z=E({__name:"table",props:{data:{},loading:{type:Boolean}},emits:["refresh","edit"],setup(A,{emit:p}){const f=A,_=p,r=v(null);function c(){return[{title:"物流单号",key:"logisticsNo",sorter:"default"},{title:"物流公司",key:"logisticsCompany",sorter:"default"},{title:"发货人",key:"sender"},{title:"发货人电话",key:"senderPhone"},{title:"收货人",key:"receiver"},{title:"收货人电话",key:"receiverPhone"},{title:"收货地址",key:"receiverAddress"},{title:"发货日期",key:"sendDate"},{title:"预计到达日期",key:"expectedArrivalDate"},{title:"实际到达日期",key:"actualArrivalDate"},{title:"状态",key:"status"},{title:"跟踪网址",key:"trackingUrl"},{title:"备注",key:"notes"}]}const m=S(),t=T(),C=c(),k=[{label:"编辑",key:"edit"},{label:()=>q("span",{style:{color:"red"}},"删除"),key:"delete"}],h=v(!1),y=v(0),x=v(0),a=h,e=y,d=x;function s(u){u==="edit"&&r.value?_("edit",r.value):u==="delete"&&r.value&&t.warning({title:"确认删除",content:`确定要删除物流资料"${r.value.logisticsNo}"吗？此操作不可恢复。`,positiveText:"删除",negativeText:"取消",onPositiveClick:async()=>{try{await N.delete(`/logistics/${r.value?.id}`),m.success("物流资料删除成功"),_("refresh")}catch(g){m.error(g.message||"物流资料删除失败")}}}),h.value=!1}function b(){h.value=!1,r.value=null}function U(u){return{onContextmenu:g=>{r.value=u,g.preventDefault(),h.value=!1,F().then(()=>{h.value=!0,y.value=g.clientX,x.value=g.clientY})},onClick:g=>{r.value=u}}}return(u,g)=>{const R=i("n-data-table"),V=i("n-dropdown"),B=i("n-flex");return I(),$(B,null,{default:n(()=>[l(R,{columns:w(C),data:f.data,"row-props":U,loading:f.loading,striped:"","row-key":o=>o.id},null,8,["columns","data","loading","row-key"]),l(V,{placement:"bottom-start",trigger:"manual",x:w(e),y:w(d),options:k,show:w(a),"on-clickoutside":b,onSelect:s},null,8,["x","y","show"])]),_:1})}}}),G=E({__name:"addInfor",props:{show:{type:Boolean},editData:{}},emits:["close","refresh","update:show"],setup(A,{emit:p}){const f=A,_=p,r=v(null),c=v(f.show),m=S(),t=v({logisticsNo:"",logisticsCompany:"",sender:"",senderPhone:"",receiver:"",receiverPhone:"",receiverAddress:"",sendDate:"",expectedArrivalDate:"",actualArrivalDate:"",status:"",trackingUrl:"",notes:"",id:void 0}),C=v([{label:"待发货",value:"待发货"},{label:"已发货",value:"已发货"},{label:"运输中",value:"运输中"},{label:"已到达",value:"已到达"},{label:"已签收",value:"已签收"},{label:"异常",value:"异常"}]),k={logisticsNo:{required:!0,message:"请输入物流单号",trigger:"blur"},logisticsCompany:{required:!0,message:"请输入物流公司",trigger:"blur"},status:{required:!0,message:"请选择状态",trigger:"blur"}};async function h(){if(r.value)try{await r.value.validate();const a={...t.value};t.value.id?(await N.put("/logistics/"+t.value.id,a),m.success("数据修改成功")):(await N.post("/logistics",a),m.success("数据保存成功")),c.value=!1,_("close"),_("refresh"),y()}catch(a){a.name==="ValidateError"?m.error("请检查表单填写是否正确"):m.error(a.message||"操作失败，请重试")}}function y(){r.value&&(t.value={logisticsNo:"",logisticsCompany:"",sender:"",senderPhone:"",receiver:"",receiverPhone:"",receiverAddress:"",sendDate:"",expectedArrivalDate:"",actualArrivalDate:"",status:"",trackingUrl:"",notes:"",id:void 0},r.value.restoreValidation())}D(()=>f.show,a=>{c.value=a}),D(()=>c.value,a=>{_("update:show",a)}),D(()=>f.editData,a=>{a?t.value={logisticsNo:a.logisticsNo||"",logisticsCompany:a.logisticsCompany||"",sender:a.sender||"",senderPhone:a.senderPhone||"",receiver:a.receiver||"",receiverPhone:a.receiverPhone||"",receiverAddress:a.receiverAddress||"",sendDate:a.sendDate||"",expectedArrivalDate:a.expectedArrivalDate||"",actualArrivalDate:a.actualArrivalDate||"",status:a.status||"",trackingUrl:a.trackingUrl||"",notes:a.notes||"",id:a.id}:y()},{immediate:!0});function x(){console.log("点击取消按钮"),c.value=!1,y()}return j(()=>{}),(a,e)=>{const d=i("n-input"),s=i("n-form-item-gi"),b=i("n-date-picker"),U=i("n-select"),u=i("n-grid"),g=i("n-button"),R=i("n-flex"),V=i("n-form"),B=i("n-modal");return I(),$(B,{show:c.value,"onUpdate:show":e[13]||(e[13]=o=>c.value=o),preset:"card",title:"新建物流资料",style:{width:"800px"}},{default:n(()=>[l(V,{ref_key:"formRef",ref:r,model:t.value,rules:k,"label-placement":"left","label-width":"auto"},{default:n(()=>[l(u,{cols:"1 s:1 m:2 l:2 xl:2 2xl:2",responsive:"screen"},{default:n(()=>[l(s,{label:"物流单号:",path:"logisticsNo"},{default:n(()=>[l(d,{value:t.value.logisticsNo,"onUpdate:value":e[0]||(e[0]=o=>t.value.logisticsNo=o),placeholder:"请输入物流单号"},null,8,["value"])]),_:1}),l(s,{label:"物流公司:",path:"logisticsCompany"},{default:n(()=>[l(d,{value:t.value.logisticsCompany,"onUpdate:value":e[1]||(e[1]=o=>t.value.logisticsCompany=o),placeholder:"请输入物流公司"},null,8,["value"])]),_:1}),l(s,{label:"发货人:",path:"sender"},{default:n(()=>[l(d,{value:t.value.sender,"onUpdate:value":e[2]||(e[2]=o=>t.value.sender=o),placeholder:"请输入发货人"},null,8,["value"])]),_:1}),l(s,{label:"发货人电话:",path:"senderPhone"},{default:n(()=>[l(d,{value:t.value.senderPhone,"onUpdate:value":e[3]||(e[3]=o=>t.value.senderPhone=o),placeholder:"请输入发货人电话"},null,8,["value"])]),_:1}),l(s,{label:"收货人:",path:"receiver"},{default:n(()=>[l(d,{value:t.value.receiver,"onUpdate:value":e[4]||(e[4]=o=>t.value.receiver=o),placeholder:"请输入收货人"},null,8,["value"])]),_:1}),l(s,{label:"收货人电话:",path:"receiverPhone"},{default:n(()=>[l(d,{value:t.value.receiverPhone,"onUpdate:value":e[5]||(e[5]=o=>t.value.receiverPhone=o),placeholder:"请输入收货人电话"},null,8,["value"])]),_:1}),l(s,{label:"收货地址:",path:"receiverAddress"},{default:n(()=>[l(d,{value:t.value.receiverAddress,"onUpdate:value":e[6]||(e[6]=o=>t.value.receiverAddress=o),placeholder:"请输入收货地址",type:"textarea"},null,8,["value"])]),_:1}),l(s,{label:"发货日期:",path:"sendDate"},{default:n(()=>[l(b,{value:t.value.sendDate,"onUpdate:value":e[7]||(e[7]=o=>t.value.sendDate=o),type:"date",placeholder:"请选择发货日期"},null,8,["value"])]),_:1}),l(s,{label:"预计到达日期:",path:"expectedArrivalDate"},{default:n(()=>[l(b,{value:t.value.expectedArrivalDate,"onUpdate:value":e[8]||(e[8]=o=>t.value.expectedArrivalDate=o),type:"date",placeholder:"请选择预计到达日期"},null,8,["value"])]),_:1}),l(s,{label:"实际到达日期:",path:"actualArrivalDate"},{default:n(()=>[l(b,{value:t.value.actualArrivalDate,"onUpdate:value":e[9]||(e[9]=o=>t.value.actualArrivalDate=o),type:"date",placeholder:"请选择实际到达日期"},null,8,["value"])]),_:1}),l(s,{label:"状态:",path:"status"},{default:n(()=>[l(U,{value:t.value.status,"onUpdate:value":e[10]||(e[10]=o=>t.value.status=o),placeholder:"请选择状态",options:C.value},null,8,["value","options"])]),_:1}),l(s,{label:"跟踪网址:",path:"trackingUrl"},{default:n(()=>[l(d,{value:t.value.trackingUrl,"onUpdate:value":e[11]||(e[11]=o=>t.value.trackingUrl=o),placeholder:"请输入跟踪网址"},null,8,["value"])]),_:1}),l(s,{label:"备注:",path:"notes"},{default:n(()=>[l(d,{value:t.value.notes,"onUpdate:value":e[12]||(e[12]=o=>t.value.notes=o),placeholder:"请输入备注",type:"textarea"},null,8,["value"])]),_:1})]),_:1}),l(R,{justify:"end"},{default:n(()=>[l(g,{"attr-type":"button",type:"error",onClick:y},{default:n(()=>[...e[14]||(e[14]=[P(" 清空 ",-1)])]),_:1}),l(g,{"attr-type":"button",type:"success",onClick:h},{default:n(()=>[...e[15]||(e[15]=[P(" 保存 ",-1)])]),_:1}),l(g,{"attr-type":"button",type:"warning",onClick:x},{default:n(()=>[...e[16]||(e[16]=[P(" 取消 ",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])}}}),H=M(G,[["__scopeId","data-v-f55a66cd"]]),J=E({__name:"index",setup(A){const p=v({logisticsNo:"",logisticsCompany:"",status:""}),f=v({logisticsNo:"",logisticsCompany:"",status:""}),_=v([]),r=v(!1),c=v(!1),m=v(null);function t(){c.value=!0,m.value=null}async function C(a){r.value=!0;try{const e=await N.get("/logistics",{params:a});_.value=e||[]}catch(e){console.error("获取物流数据失败:",e),_.value=[]}finally{r.value=!1}}async function k(a){await C(a)}const h=Y.debounce(()=>{f.value={...p.value},console.log("防抖搜索执行，参数：",f.value),k(f.value)},1e3);D(()=>p.value,()=>{h()},{deep:!0}),L(()=>{k(f.value)});function y(){k(f.value)}function x(a){m.value=a,c.value=!0}return(a,e)=>{const d=i("n-input"),s=i("n-form-item"),b=i("n-flex"),U=i("n-button");return I(),O(X,null,[l(b,null,{default:n(()=>[l(s,{label:"物流单号:"},{default:n(()=>[l(d,{value:p.value.logisticsNo,"onUpdate:value":e[0]||(e[0]=u=>p.value.logisticsNo=u),placeholder:"请输入物流单号"},null,8,["value"])]),_:1}),l(s,{label:"物流公司:"},{default:n(()=>[l(d,{value:p.value.logisticsCompany,"onUpdate:value":e[1]||(e[1]=u=>p.value.logisticsCompany=u),placeholder:"请输入物流公司"},null,8,["value"])]),_:1}),l(s,{label:"状态:"},{default:n(()=>[l(d,{value:p.value.status,"onUpdate:value":e[2]||(e[2]=u=>p.value.status=u),placeholder:"请输入状态"},null,8,["value"])]),_:1})]),_:1}),l(b,null,{default:n(()=>[l(U,{onClick:e[3]||(e[3]=u=>t())},{default:n(()=>[...e[5]||(e[5]=[P(" 新增物流资料 ",-1)])]),_:1})]),_:1}),l(z,{data:_.value,loading:r.value,onEdit:x,onRefresh:y},null,8,["data","loading"]),l(b,null,{default:n(()=>[l(H,{show:c.value,"onUpdate:show":e[4]||(e[4]=u=>c.value=u),editData:m.value,onRefresh:y},null,8,["show","editData"])]),_:1})],64)}}}),Z=M(J,[["__scopeId","data-v-2617fbd2"]]);export{Z as default};
